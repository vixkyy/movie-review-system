<div class="container my-5 text-light">
  <div class="row align-items-center">
    <div class="col-md-6 d-flex justify-content-center">
      <div class="col-lg-8 text-center text-md-start">
        <h1 class="fw-bold mb-4"><%= @movie.name %></h1>
<p class="fs-5 mb-2">
  <strong>Release date:</strong> <%= @movie.release_date %>
</p>
<p class="fs-5 mb-2">
  <strong>Director:</strong> <%= @movie.director %>
</p>
<p class="fs-5 mb-2">
  <strong>Actor:</strong> <%= @movie.actor %>
</p>
      </div>
    </div>
    <div class="col-md-6 d-flex justify-content-center mb-3">
      <div class="col-lg-8 text-center">
        <% if @movie.image.attached? %>
          <%= image_tag @movie.image,class: "img-fluid rounded" %>
        <% end %>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-md-6 d-flex justify-content-center">
      <div class="col-lg-8">
        <h4 class="fw-bold mb-3">Ratings</h4>

        <% if @movie.ratings.any? %>
          <% (1..5).each do |num| %>
            <div class="d-flex justify-content-start fs-5 mb-1">
              <span class="ms-3"><%= num %> Stars:</span>
              <span><%= @ratings_count[num] || 0 %></span>
            </div>
          <% end %>
        <% else %>
          <p class="text-secondary fs-5">No one rated yet.</p>
        <% end %>
      </div>
    </div>

    <div class="col-md-6 d-flex justify-content-center">
      <div class="col-lg-8">
        <h4 class="fw-bold mb-3">Your Rating</h4>

        <% if @movie.ratings.exists?(user_id: current_user.id) %>
          <% rating = @movie.ratings.find_by(user_id: current_user.id) %>

          <p class="fs-5 mb-2">
            You rated: <strong><%= rating.score %></strong>
          </p>

          <%= form_with model: [@movie, rating] do |form| %>
            <div class="mb-3">
              <% (1..5).each do |num| %>
                <%= form.radio_button :score, num %> <%= num %>
              <% end %>
            </div>
            <%= form.submit "Update rating",class: "btn btn-success btn-sm" %>
          <% end %>

        <% else %>

          <%= form_with model: [@movie, Rating.new] do |form| %>
            <div class="mb-3">
              <% (1..5).each do |num| %>
                <%= form.radio_button :score, num %> <%= num %>
              <% end %>
            </div>
            <%= form.submit "Submit rating",class: "btn btn-success btn-sm" %>
          <% end %>

        <% end %>
      </div>
    </div>

  </div>
  <div class="row mt-3">
    <div class="col-md-6 d-flex justify-content-center">
      <div class="col-lg-8">
        <h4 class="fw-bold mb-3">Reviews</h4>

        <% if @movie.comments.any? %>
          <%= link_to "See all reviews",movie_comments_path(@movie),class: "btn btn-light btn-sm mb-3" %>
        <% else %>
          <p class="text-secondary fs-5">No reviews yet.</p>
        <% end %>

        <% if @movie.comments.exists?(user_id: current_user.id) %>
          <p class="fs-5 mb-2">
            <strong>Your review:</strong><br>
          </p>
          <p class="fw-medium"><%= @movie.comments.find_by(user_id: current_user.id).body %></p>
        <% end %>
      </div>
    </div>
    <div class="col-md-6 d-flex justify-content-center">
      <div class="col-lg-8">
        <% unless @movie.comments.exists?(user_id: current_user.id) %>
          <h4 class="fw-bold mb-3">Post a review</h4>
          <%= form_with model: [@movie, Comment.new] do |form| %>
            <%= form.text_area :body,rows: 4,class: "form-control mb-2" %>
            <%= form.submit "Submit review",class: "btn btn-success btn-sm" %>
          <% end %>
        <% end %>
      </div>
    </div>

  </div>
  <div class="d-flex justify-content-center">
    <% if can? :update, Movie%>
    <%= link_to "Edit",edit_movie_path(@movie),class: "btn btn-secondary text-dark" %>
    <%end%>

    <%= link_to "Back",movies_path,class: "btn btn-secondary text-dark" %>
  </div>

</div>
